(()=>{var Ue=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports);var Fe=Ue((wt,Ge)=>{Ge.exports={name:"@loglib/tracker",version:"0.8.0",description:"A simple tracker for loglib",main:"./dist/index.js",packageManager:"pnpm@7.9.5",scripts:{test:"vitest",dev:"rm -rf /dist & tsup --watch",build:"rm -rf /dist & tsup",lint:"rome check ."},exports:{".":{browser:"./dist/index.js",import:"./dist/index.js",require:"./dist/index.cjs"},"./react":{browser:"./dist/react/index.js",import:"./dist/react/index.js",require:"./dist/react/index.cjs"}},typesVersions:{"*":{"*":["dist/index.d.ts"],react:["dist/react/index.d.ts"]}},types:"dist/index.d.ts",keywords:["loglib","event tracker","web analytics","analytics"],author:"",license:"MIT",files:["dist","package.json","LICENSE","README.md"],devDependencies:{"@changesets/changelog-git":"^0.1.14","@changesets/changelog-github":"^0.4.8","@changesets/cli":"^2.26.1","@loglib/types":"0.0.1","@types/jest":"^29.5.1","@types/node":"^18.15.13","@types/react":"^18.2.0","@types/testing-library__jest-dom":"^5.14.5","@vitest/browser":"^0.31.1","happy-dom":"^9.20.3",react:"^18.2.0",sinon:"^15.0.4",terser:"^5.17.3",tsup:"^6.7.0",typescript:"^5.1.6",vitest:"^0.31.0",webdriverio:"^8.10.5"},peerDependencies:{react:"^16.8||^17||^18"},dependencies:{"web-vitals":"^3.4.0"}}});function b(){let e=()=>localStorage.getItem("loglib-id");return window.llc.consent==="denied"&&!e()?"":(window.llc.consent="granted",e()||window.localStorage.setItem("loglib-id",h()),e())}function Z(){window.lli.eventsBank=[]}function ee(e){return!!e.target.hasAttribute("doNotTrack")}var P=()=>{let e=new URLSearchParams(window.location.search);return Object.fromEntries(e.entries())};function te(){return window.llc.env==="dev"}function h(){let e=new Date().getTime();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,r=>{let i=(e+Math.random()*16)%16|0;return e=Math.floor(e/16),(r==="x"?i:i&3|8).toString(16)})}function ne(){try{let e=process.env.NODE_ENV;if(e==="development"||e==="test")return"dev"}catch{return"prod"}return"prod"}var ie=e=>e.substring(0,4)==="http"?`/${e.split("/").splice(3).join("/")}`:e,q=(e,t,r)=>{let i=e[t];return(...n)=>(r(...n),i.apply(e,n))},re=()=>{window.lli.intervals.forEach(e=>clearInterval(e))},V=e=>{window.lli.intervals.push(e)};function oe(e){window.lli.eventsBank.push(e)}function ae(){return typeof process>"u"?"https://api.loglib.io":process.env.NEXT_PUBLIC_LOGLIB_URL||process.env.LOGLIB_URL?`${process.env.NEXT_PUBLIC_LOGLIB_URL??process.env.LOGLIB_URL}/api/loglib`:"https://api.loglib.io"}var O=e=>e==="https://loglib.io"||e==="https://www.loglib.io"?"https://loglib.io/api/loglib":e;var se=e=>{let t=e.target,r={};ee(e)||window.llc.autoTrack&&(typeof t.onclick!="function"&&t.nodeName!=="BUTTON"||oe({id:h(),eventName:t.textContent?.replace(/[\W_]+/g,"")??"",eventType:"click",page:location.pathname,payload:r}))};var k=e=>({log(...t){e&&console.log(...t)},error(...t){e&&console.error(...t)}});function W(e,t){let r={id:window.lli.pageId,path:"/hits",currentPath:t,referrerPath:e,referrerDomain:document.referrer,websiteId:window.llc.id,host:location.href,sdkVersion:window.lli.sdkVersion,visitorId:b(),sessionId:window.lli.sessionId,screenWidth:window.screen.width,language:navigator.language,queryParams:P(),pageId:window.lli.pageId,duration:(Date.now()-window.lli.timeOnPage)/1e3};A(r)}function S(){if(window.lli.eventsBank.length){let e={path:"/event",events:window.lli.eventsBank,websiteId:window.llc.id,visitorId:b(),sessionId:window.lli.sessionId,screenWidth:window.screen.width,language:navigator.language??"en"};A(e,Z)}}async function A(e,t,r,i){let n=k(window.llc.debug),o=i?window.llc.host+i:window.llc.host;if(!e||Array.isArray(e)&&e.length===0){n.log("skipping empty request...");return}if(te()){n.log("skipping development logs...");return}n.log("sending...",e);let a=0,s=3;async function c(l){try{window.llc.useBeacon?(navigator.sendBeacon(l,JSON.stringify(e)),t?.()):await fetch(l,{body:JSON.stringify(e),method:"POST",keepalive:!0,headers:{"Content-Type":"application/json"}}).then(()=>t?.())}catch{let u=new XMLHttpRequest;u.open("POST",l),u.setRequestHeader("Content-Type","text/plain"),u.onload=async()=>{u.status===200?t?.():await d(),n.error(u.statusText)},u.onerror=async()=>{r?.(),await d(),n.error("Couldn't send request to the server. See the XHR error.")},u.send(JSON.stringify(e))}}async function d(){a<s?(a++,n.log(`Retrying request. Attempt ${a} of ${s}...`),await new Promise(l=>setTimeout(l,1e3*a))):n.error("Request failed after multiple retries.")}if(Array.isArray(o))for(let l of o)await c(l);else await c(o)}var m,E,ye,B,Q,T=function(){return window.performance&&performance.getEntriesByType&&performance.getEntriesByType("navigation")[0]},L=function(e){if(document.readyState==="loading")return"loading";var t=T();if(t){if(e<t.domInteractive)return"loading";if(t.domContentLoadedEventStart===0||e<t.domContentLoadedEventStart)return"dom-interactive";if(t.domComplete===0||e<t.domComplete)return"dom-content-loaded"}return"complete"},qe=function(e){var t=e.nodeName;return e.nodeType===1?t.toLowerCase():t.toUpperCase().replace(/^#/,"")},R=function(e,t){var r="";try{for(;e&&e.nodeType!==9;){var i=e,n=i.id?"#"+i.id:qe(i)+(i.classList&&i.classList.value&&i.classList.value.trim()&&i.classList.value.trim().length?"."+i.classList.value.trim().replace(/\s+/g,"."):"");if(r.length+n.length>(t||100)-1)return r||n;if(r=r?n+">"+r:n,i.id)break;e=i.parentNode}}catch{}return r},Te=-1,xe=function(){return Te},w=function(e){addEventListener("pageshow",function(t){t.persisted&&(Te=t.timeStamp,e(t))},!0)},F=function(){var e=T();return e&&e.activationStart||0},f=function(e,t){var r=T(),i="navigate";return xe()>=0?i="back-forward-cache":r&&(document.prerendering||F()>0?i="prerender":document.wasDiscarded?i="restore":r.type&&(i=r.type.replace(/_/g,"-"))),{name:e,value:t===void 0?-1:t,rating:"good",delta:0,entries:[],id:"v3-".concat(Date.now(),"-").concat(Math.floor(8999999999999*Math.random())+1e12),navigationType:i}},x=function(e,t,r){try{if(PerformanceObserver.supportedEntryTypes.includes(e)){var i=new PerformanceObserver(function(n){Promise.resolve().then(function(){t(n.getEntries())})});return i.observe(Object.assign({type:e,buffered:!0},r||{})),i}}catch{}},p=function(e,t,r,i){var n,o;return function(a){t.value>=0&&(a||i)&&((o=t.value-(n||0))||n===void 0)&&(n=t.value,t.delta=o,t.rating=function(s,c){return s>c[1]?"poor":s>c[0]?"needs-improvement":"good"}(t.value,r),e(t))}},$=function(e){requestAnimationFrame(function(){return requestAnimationFrame(function(){return e()})})},N=function(e){var t=function(r){r.type!=="pagehide"&&document.visibilityState!=="hidden"||e(r)};addEventListener("visibilitychange",t,!0),addEventListener("pagehide",t,!0)},J=function(e){var t=!1;return function(r){t||(e(r),t=!0)}},y=-1,ce=function(){return document.visibilityState!=="hidden"||document.prerendering?1/0:0},D=function(e){document.visibilityState==="hidden"&&y>-1&&(y=e.type==="visibilitychange"?e.timeStamp:0,Ve())},le=function(){addEventListener("visibilitychange",D,!0),addEventListener("prerenderingchange",D,!0)},Ve=function(){removeEventListener("visibilitychange",D,!0),removeEventListener("prerenderingchange",D,!0)},G=function(){return y<0&&(y=ce(),le(),w(function(){setTimeout(function(){y=ce(),le()},0)})),{get firstHiddenTime(){return y}}},C=function(e){document.prerendering?addEventListener("prerenderingchange",function(){return e()},!0):e()},ue=[1800,3e3],be=function(e,t){t=t||{},C(function(){var r,i=G(),n=f("FCP"),o=x("paint",function(a){a.forEach(function(s){s.name==="first-contentful-paint"&&(o.disconnect(),s.startTime<i.firstHiddenTime&&(n.value=Math.max(s.startTime-F(),0),n.entries.push(s),r(!0)))})});o&&(r=p(e,n,ue,t.reportAllChanges),w(function(a){n=f("FCP"),r=p(e,n,ue,t.reportAllChanges),$(function(){n.value=performance.now()-a.timeStamp,r(!0)})}))})},de=[.1,.25],Se=function(e,t){(function(r,i){i=i||{},be(J(function(){var n,o=f("CLS",0),a=0,s=[],c=function(l){l.forEach(function(u){if(!u.hadRecentInput){var v=s[0],U=s[s.length-1];a&&u.startTime-U.startTime<1e3&&u.startTime-v.startTime<5e3?(a+=u.value,s.push(u)):(a=u.value,s=[u])}}),a>o.value&&(o.value=a,o.entries=s,n())},d=x("layout-shift",c);d&&(n=p(r,o,de,i.reportAllChanges),N(function(){c(d.takeRecords()),n(!0)}),w(function(){a=0,o=f("CLS",0),n=p(r,o,de,i.reportAllChanges),$(function(){return n()})}),setTimeout(n,0))}))})(function(r){(function(i){if(i.entries.length){var n=i.entries.reduce(function(s,c){return s&&s.value>c.value?s:c});if(n&&n.sources&&n.sources.length){var o=(a=n.sources).find(function(s){return s.node&&s.node.nodeType===1})||a[0];if(o)return void(i.attribution={largestShiftTarget:R(o.node),largestShiftTime:n.startTime,largestShiftValue:n.value,largestShiftSource:o,largestShiftEntry:n,loadState:L(n.startTime)})}}var a;i.attribution={}})(r),e(r)},t)},Ie=function(e,t){be(function(r){(function(i){if(i.entries.length){var n=T(),o=i.entries[i.entries.length-1];if(n){var a=n.activationStart||0,s=Math.max(0,n.responseStart-a);return void(i.attribution={timeToFirstByte:s,firstByteToFCP:i.value-s,loadState:L(i.entries[0].startTime),navigationEntry:n,fcpEntry:o})}}i.attribution={timeToFirstByte:0,firstByteToFCP:i.value,loadState:L(xe())}})(r),e(r)},t)},I={passive:!0,capture:!0},Oe=new Date,fe=function(e,t){m||(m=t,E=e,ye=new Date,Le(removeEventListener),Ee())},Ee=function(){if(E>=0&&E<ye-Oe){var e={entryType:"first-input",name:m.type,target:m.target,cancelable:m.cancelable,startTime:m.timeStamp,processingStart:m.timeStamp+E};B.forEach(function(t){t(e)}),B=[]}},We=function(e){if(e.cancelable){var t=(e.timeStamp>1e12?new Date:performance.now())-e.timeStamp;e.type=="pointerdown"?function(r,i){var n=function(){fe(r,i),a()},o=function(){a()},a=function(){removeEventListener("pointerup",n,I),removeEventListener("pointercancel",o,I)};addEventListener("pointerup",n,I),addEventListener("pointercancel",o,I)}(t,e):fe(t,e)}},Le=function(e){["mousedown","keydown","touchstart","pointerdown"].forEach(function(t){return e(t,We,I)})},pe=[100,300],He=function(e,t){t=t||{},C(function(){var r,i=G(),n=f("FID"),o=function(c){c.startTime<i.firstHiddenTime&&(n.value=c.processingStart-c.startTime,n.entries.push(c),r(!0))},a=function(c){c.forEach(o)},s=x("first-input",a);r=p(e,n,pe,t.reportAllChanges),s&&N(J(function(){a(s.takeRecords()),s.disconnect()})),s&&w(function(){var c;n=f("FID"),r=p(e,n,pe,t.reportAllChanges),B=[],E=-1,m=null,Le(addEventListener),c=o,B.push(c),Ee()})})},Ce=function(e,t){He(function(r){(function(i){var n=i.entries[0];i.attribution={eventTarget:R(n.target),eventType:n.name,eventTime:n.startTime,eventEntry:n,loadState:L(n.startTime)}})(r),e(r)},t)},Pe=0,H=1/0,M=0,je=function(e){e.forEach(function(t){t.interactionId&&(H=Math.min(H,t.interactionId),M=Math.max(M,t.interactionId),Pe=M?(M-H)/7+1:0)})},ke=function(){return Q?Pe:performance.interactionCount||0},_e=function(){"interactionCount"in performance||Q||(Q=x("event",je,{type:"event",buffered:!0,durationThreshold:0}))},ge=[200,500],Ae=0,ve=function(){return ke()-Ae},g=[],j={},me=function(e){var t=g[g.length-1],r=j[e.interactionId];if(r||g.length<10||e.duration>t.latency){if(r)r.entries.push(e),r.latency=Math.max(r.latency,e.duration);else{var i={id:e.interactionId,latency:e.duration,entries:[e]};j[i.id]=i,g.push(i)}g.sort(function(n,o){return o.latency-n.latency}),g.splice(10).forEach(function(n){delete j[n.id]})}},Qe=function(e,t){t=t||{},C(function(){var r;_e();var i,n=f("INP"),o=function(s){s.forEach(function(l){l.interactionId&&me(l),l.entryType==="first-input"&&!g.some(function(u){return u.entries.some(function(v){return l.duration===v.duration&&l.startTime===v.startTime})})&&me(l)});var c,d=(c=Math.min(g.length-1,Math.floor(ve()/50)),g[c]);d&&d.latency!==n.value&&(n.value=d.latency,n.entries=d.entries,i())},a=x("event",o,{durationThreshold:(r=t.durationThreshold)!==null&&r!==void 0?r:40});i=p(e,n,ge,t.reportAllChanges),a&&("interactionId"in PerformanceEventTiming.prototype&&a.observe({type:"first-input",buffered:!0}),N(function(){o(a.takeRecords()),n.value<0&&ve()>0&&(n.value=0,n.entries=[]),i(!0)}),w(function(){g=[],Ae=ke(),n=f("INP"),i=p(e,n,ge,t.reportAllChanges)}))})},Me=function(e,t){Qe(function(r){(function(i){if(i.entries.length){var n=i.entries.sort(function(o,a){return a.duration-o.duration||a.processingEnd-a.processingStart-(o.processingEnd-o.processingStart)})[0];i.attribution={eventTarget:R(n.target),eventType:n.name,eventTime:n.startTime,eventEntry:n,loadState:L(n.startTime)}}else i.attribution={}})(r),e(r)},t)},he=[2500,4e3],_={},Be=function(e,t){(function(r,i){i=i||{},C(function(){var n,o=G(),a=f("LCP"),s=function(l){var u=l[l.length-1];u&&u.startTime<o.firstHiddenTime&&(a.value=Math.max(u.startTime-F(),0),a.entries=[u],n())},c=x("largest-contentful-paint",s);if(c){n=p(r,a,he,i.reportAllChanges);var d=J(function(){_[a.id]||(s(c.takeRecords()),c.disconnect(),_[a.id]=!0,n(!0))});["keydown","click"].forEach(function(l){addEventListener(l,function(){return setTimeout(d,0)},!0)}),N(d),w(function(l){a=f("LCP"),n=p(r,a,he,i.reportAllChanges),$(function(){a.value=performance.now()-l.timeStamp,_[a.id]=!0,n(!0)})})}})})(function(r){(function(i){if(i.entries.length){var n=T();if(n){var o=n.activationStart||0,a=i.entries[i.entries.length-1],s=a.url&&performance.getEntriesByType("resource").filter(function(U){return U.name===a.url})[0],c=Math.max(0,n.responseStart-o),d=Math.max(c,s?(s.requestStart||s.startTime)-o:0),l=Math.max(d,s?s.responseEnd-o:0),u=Math.max(l,a?a.startTime-o:0),v={element:R(a.element),timeToFirstByte:c,resourceLoadDelay:d-c,resourceLoadTime:l-d,elementRenderDelay:u-l,navigationEntry:n,lcpEntry:a};return a.url&&(v.url=a.url),s&&(v.lcpResourceEntry=s),void(i.attribution=v)}}i.attribution={timeToFirstByte:0,resourceLoadDelay:0,resourceLoadTime:0,elementRenderDelay:i.value}})(r),e(r)},t)},we=[800,1800],$e=function e(t){document.prerendering?C(function(){return e(t)}):document.readyState!=="complete"?addEventListener("load",function(){return e(t)},!0):setTimeout(t,0)},Je=function(e,t){t=t||{};var r=f("TTFB"),i=p(e,r,we,t.reportAllChanges);$e(function(){var n=T();if(n){var o=n.responseStart;if(o<=0||o>performance.now())return;r.value=Math.max(o-F(),0),r.entries=[n],i(!0),w(function(){r=f("TTFB",0),(i=p(e,r,we,t.reportAllChanges))(!0)})}})},De=function(e,t){Je(function(r){(function(i){if(i.entries.length){var n=i.entries[0],o=n.activationStart||0,a=Math.max(n.domainLookupStart-o,0),s=Math.max(n.connectStart-o,0),c=Math.max(n.requestStart-o,0);i.attribution={waitingTime:a,dnsTime:s-a,connectionTime:c-s,requestTime:i.value-c,navigationEntry:n}}else i.attribution={waitingTime:0,dnsTime:0,connectionTime:0,requestTime:0}})(r),e(r)},t)};function Re(){let e=window.lli.vitalQueue;function t(r){let i={visitorId:b(),sessionId:window.lli.sessionId,sdkVersion:window.lli.sdkVersion,screenWidth:window.screen.width,language:navigator.language,queryParams:P(),currentPath:window.lli.currentUrl,id:r.id,delta:r.delta,value:r.value,name:r.name,rating:r.rating,navigationType:r.navigationType,websiteId:window.llc.id};e.add(i)}Se(t),Ie(t),Ce(t),Me(t),De(t),Be(t)}function X(){let e=window.lli.vitalQueue;e.size>0&&(A([...e],void 0,void 0,"/vitals"),e.clear())}function K(e){let t={id:"",debug:!1,autoTrack:!1,env:"auto",postInterval:5,host:ae(),consent:"denied",webVitals:!0,pageAnalytics:!0,customEvents:!0};e?.host&&(Array.isArray(e.host)?e.host=e.host.map(o=>O(o)):e.host=O(e.host)),window.llc=e?{...t,...e}:t;let r=Date.now(),i=Fe();if(window.lli={eventsBank:[],vitalQueue:new Set,startTime:r,currentUrl:`${location.pathname}${location.search}`,currentRef:document.referrer,timeOnPage:r,sessionId:h(),pageId:h(),intervals:[],sdkVersion:i.version},k(window.llc.debug).log("start recording...",window.llc),window.llc.env==="auto"){let o=ne();window.llc.env=o}if(window.llc.autoTrack&&window.addEventListener("click",se),window.llc.webVitals){Re();let o=setInterval(()=>{X()},window.llc.postInterval*1e3);V(o),z(X)}if(window.llc.customEvents){let o=setInterval(()=>{S()},window.llc.postInterval*1e3);V(o),z(S)}if(window.llc.pageAnalytics){history.pushState=q(history,"pushState",Ne),history.replaceState=q(history,"replaceState",Ne);let o=window.lli.currentRef,a=window.lli.currentUrl;z(()=>W(o,a))}}var Ne=(e,t,r)=>{if(!r)return;let i=window.lli.currentRef,n=window.lli.currentUrl;window.lli.currentRef=window.lli.currentUrl,window.lli.currentUrl=ie(r.toString()),n!==i&&(W(n,i),S(),window.lli.pageId=h(),window.lli.timeOnPage=Date.now())},z=async e=>{document.onvisibilitychange=()=>{document.visibilityState==="hidden"?(e(),S(),re()):window.llc&&K(window.llc)}};var Y=document.currentScript,Xe=Y.getAttribute("data-id"),ze=Y.getAttribute("data-host")??"https://api.loglib.io",Ke=Y.getAttribute("data-consent")??"denied";K({id:Xe,host:ze,consent:Ke});})();
